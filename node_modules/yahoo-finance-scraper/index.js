const axios = require('axios')

const BASE_URL = 'https://query1.finance.yahoo.com/v8/finance/chart'

module.exports = function (symbol, start, end, interval = '1d') {

  const query = {
    period1: new Date(start).getTime()/1000,
    period2: new Date(end).getTime()/1000,
    interval,
  }

  const querystring = Object.keys(query).map(key=>`${key}=${query[key]}`).join('&')

  const url = `${BASE_URL}/${symbol}?${querystring}`

  return axios.get(url).then((result) => {
    const data = result.data.chart.result[0]
    return {
      timestap: data.timestamp,
      ...data.indicators.quote[0],
    }
  })
}
